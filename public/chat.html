<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Live Chat</title>

  <link rel="stylesheet" href="./chat.css" />
  <script defer src="./chat.js"></script>

  <style>
    :root{
      --bg:#0b0d11; --surface:#0f1115; --panel:#151820; --panel2:#1a1d24;
      --stroke:#242834; --text:#f3f4f6; --muted:#a2a8b3; --ok:#10b981; --accent:#ffd024;
      --radius:18px;
    }
    html,body{
      height:100%;
      background:var(--bg);
      color:var(--text);
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      -webkit-text-size-adjust:100%; /* âœ… cegah auto zoom iOS */
    }
    .wrap{min-height:100%;display:flex;flex-direction:column}

    /* ====== HEADER ====== */
    .header{
      position:sticky; top:0; z-index:20;
      background:radial-gradient(800px 300px at 80% -40%, rgba(255,208,36,.12), transparent 60%),
                 radial-gradient(700px 280px at 20% -30%, rgba(16,185,129,.10), transparent 60%),
                 linear-gradient(180deg,#0f1218,#0b0d11);
      border-bottom:1px solid var(--stroke);
      padding:10px 12px 28px; /* space for floating card */
    }
    .hdr-row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .iconbtn{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;border:1px solid #20242d;background:#12151b;color:#d1d5db;cursor:pointer}
    .iconbtn svg{width:18px;height:18px}
    .hdr-title{font-weight:800; letter-spacing:.2px}
    .hdr-actions{display:flex;align-items:center;gap:10px}

    /* Agent card centered */
    .agent-card{
      position:relative; max-width:720px; margin:0 auto;
      transform:translateY(18px);
      background:#141823; border:1px solid var(--stroke); border-radius:24px; padding:10px 14px;
      box-shadow:0 18px 50px rgba(0,0,0,.45);
      display:flex; align-items:center; gap:12px; justify-content:center;
    }
    .agent-card .avatar{width:44px;height:44px;border-radius:999px;overflow:hidden;border:1px solid #2b2f38;background:#0f1218}
    .agent-card .avatar img{width:100%;height:100%;object-fit:cover}
    .agent-card .name{font-weight:800}
    .agent-card .role{font-size:12px;color:#cbd5e1}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--ok);box-shadow:0 0 0 2px rgba(16,185,129,.35);display:inline-block}

    /* ====== PRECHAT ====== */
    .pre{padding:40px 16px 16px}
    .card{max-width:820px;margin:0 auto;background:#171b25;border:1px solid var(--stroke);border-radius:24px;padding:20px;box-shadow:0 14px 40px rgba(0,0,0,.45)}
    .card h3{margin:0 0 12px;font-size:18px;font-weight:800}
    .field{display:grid;gap:8px;margin:12px 0}
    .label{color:#cbd5e1;font-size:14px}
    .req{color:#fbbf24}
    .input,.select{width:100%;padding:12px 14px;border:1px solid #374151;border-radius:12px;background:#0f1218;color:#fff;outline:none;font-size:16px} /* âœ… font-size fix */
    .submit{margin-top:8px;height:52px;width:100%;border:none;border-radius:14px;background:var(--accent);color:#111827;font-weight:900;letter-spacing:.2px;cursor:pointer;box-shadow:0 14px 30px rgba(255,208,36,.22),inset 0 -2px 0 rgba(0,0,0,.2)}
    .powered{text-align:center;color:#a3a3a3;font-size:12px;padding:22px 0}

    /* ====== CHAT PANEL ====== */
    .chat{display:none;flex-direction:column;height:calc(100dvh - 0px)}
    .chat.open{display:flex}
    .messages{flex:1;overflow-y:auto;padding:16px 10px 90px;background:#0f1218}
    .msg{display:flex;gap:10px;margin:8px 0}
    .msg .pp{width:28px;height:28px;border-radius:999px;background:#1b1f2a;border:1px solid #2a2f3a;overflow:hidden;flex:0 0 auto}
    .msg .pp img{width:100%;height:100%;object-fit:cover}
    .bubble{max-width:72%;padding:12px 14px;border-radius:16px;border:1px solid #2a2f3a;background:#171b25;color:var(--text)}
    .msg.visitor{justify-content:flex-end}
    .msg.visitor .pp{display:none}
    .msg.visitor .bubble{background:#212734}
    .msg .meta{margin-top:4px;color:#8e96a3;font-size:11px}
    .bubble img{max-width:260px;border-radius:12px;display:block}

    /* input bar floating */
    .composer{
      position:fixed;left:0;right:0;bottom:env(safe-area-inset-bottom,0);
      padding:12px 14px; background:linear-gradient(180deg,rgba(11,13,17,0),#0b0d11 30%, #0b0d11 100%);
    }
    .bar{
      max-width:1060px;margin:0 auto;display:flex;align-items:center;gap:8px;
      background:#0f1218;border:1px solid #27303b;border-radius:16px;padding:10px;box-shadow:0 10px 30px rgba(0,0,0,.35)
    }
    .tool{width:38px;height:38px;border-radius:12px;border:1px solid #27303b;background:#0f1218;color:#d1d5db;display:grid;place-items:center;cursor:pointer}
    .bar input{flex:1;height:38px;border:1px solid #27303b;border-radius:12px;background:#0b0f15;color:#fff;padding:0 12px;font-size:16px} /* âœ… font-size fix */
    .send{height:38px;border:none;border-radius:12px;background:#ffd024;color:#111827;font-weight:800;padding:0 14px;cursor:pointer}

    /* emoji panel */
    .emoji-panel{position:fixed;bottom:96px;left:50%;transform:translateX(-50%);z-index:25;background:#171a21;border:1px solid var(--stroke);border-radius:12px;padding:10px;display:none;max-width:360px;max-height:280px;overflow:auto;box-shadow:0 20px 44px rgba(0,0,0,.45)}
    .emoji-grid{display:grid;grid-template-columns:repeat(10,28px);gap:6px}
    .emoji-grid button{width:28px;height:28px;border-radius:8px;border:1px solid #28303a;background:#0f1218;color:#fff;cursor:pointer}

    /* âœ… Responsif tambahan */
    @media (max-width:600px){
      .agent-card{flex-direction:column;text-align:center}
      .bubble{max-width:85%}
      .bar{padding:8px}
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- ===== HEADER ===== -->
    <div class="header">
      <div class="hdr-row">
        <a href="./index.html" class="iconbtn" aria-label="Kembali">
          <svg viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </a>
        <div class="hdr-title" aria-hidden="true"></div>
      </div>

      <!-- kartu agent di tengah -->
      <div class="agent-card">
        <div class="avatar"><img src="img/agent.jpg" alt="logo"></div>
        <div>
          <div class="name">CAKWE 77</div>
          <div class="role">Customer Service <span class="dot" style="margin-left:6px"></span></div>
        </div>
      </div>
    </div>

    <!-- ===== PRECHAT ===== -->
    <section class="pre" id="prechat">
      <div class="card">
        <h3>Selamat datang di CAKWE77! Silakan isi formulir di bawah ini sebelum memulai obrolan.</h3>
        <div class="field">
          <label class="label">username: <span class="req">*</span></label>
          <input id="mcx-username" class="input" placeholder="cth: cakweuser" required />
        </div>
        <div class="field">
          <label class="label">Pertanyaan: <span class="req">*</span></label>
          <select id="mcx-topic" class="select" required>
            <option value="">-- pilih --</option>
            <option>TopUp ( online )</option>
            <option>Withdraw ( online )</option>
            <option>Kendala ( Registrasi, Akun, Dll )</option>
          </select>
        </div>
        <button id="mcx-start" class="submit">Mulai obrolan</button>
      </div>
      <div class="powered">Powered by McX Dev</div>
    </section>

    <!-- ===== CHAT ===== -->
    <section class="chat" id="mcx-chat">
      <div class="messages" id="mcx-msgs"></div>

      <div class="emoji-panel" id="mcx-emoji">
        <div class="emoji-grid" id="mcx-emoji-grid"></div>
      </div>

      <div class="composer">
        <div class="bar">
          <button class="tool" id="btn-emoji" title="Emoji">ðŸ˜Š</button>
          <button class="tool" id="btn-attach" title="Lampirkan">ðŸ“Ž</button>
          <input id="mcx-input" placeholder="Tulis pesan..." />
          <button class="send" id="btn-send">Kirim</button>
        </div>
      </div>

      <input type="file" id="mcx-picker" accept="image/*" style="display:none" />
    </section>
  </div>

  <script>
    document.getElementById('mcx-start').addEventListener('click', () => {
      const name  = (document.getElementById('mcx-username').value || '').trim();
      const topic = (document.getElementById('mcx-topic').value || '').trim();
      if (!name || !topic) { alert('Mohon isi username & pilih pertanyaan.'); return; }
      if (window.MCX_START_CHAT) window.MCX_START_CHAT({ name, topic });
    });
    const url = new URL(location.href);
    if (url.searchParams.get('embed') === '1') {
      const backBtn = document.querySelector('.iconbtn'); 
      if (backBtn) backBtn.remove();
    }
  </script>
</body>
</html>
